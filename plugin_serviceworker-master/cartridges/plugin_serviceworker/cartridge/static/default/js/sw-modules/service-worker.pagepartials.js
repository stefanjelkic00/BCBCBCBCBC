!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}({0:function(e,t){var r={createResponseSkeleton:function(e){var t={status:e.status,statusText:e.statusText,headers:{"X-ServedByServiceWorker":"true"}};if(e.headers.forEach((function(e,r){t.headers[r]=e})),t.headers["x-sf-cc-cachetime"]){var r=t.headers["x-sf-cc-cachetime"].replace(/\D+/g,""),n=t.headers["x-sf-cc-cachetime"].indexOf("h")>-1?"hours":"minutes",o=(new Date).getTime(),a=0;a="hours"===n?o+60*r*60*1e3:o+60*r*1e3,t.headers["x-sf-cc-cache-validto"]=a}return t},replacePartialPlaceholder:function(e,t,r){for(var n,o=e,a=0;a<t.length;a++){var c="$sw"+t[a].cachekey+"$";o.indexOf(c)>-1&&(n=!0),o=o.replace(c,t[a].content)}return self.canLazyLoadImages&&(o=o.replace(/(<img.*?\s)src=(?:'|")([^'">]+)(?:'|")/g,'$1data-lazysrc="$2"')),(n||r)&&(o=o.replace(/\$swcached\$/g,"true")),o},pushOnStream:function(e,t){const r=e.getReader();return r.read().then((function e(n){if(!n.done)return t.enqueue(n.value),r.read().then(e)}))},reloadHeader:async function(e,t){var r=await fetch(e),n=r.clone(),o=await n.text(),a=new Response(o.replace(/\$swcached\$/g,"true"));return t.put(e,a),r},isCacheExpired:function(e){var t=0;return e.headers.forEach((function(e,r){"x-sf-cc-cache-validto"===r&&(t=e)})),t<=Date.now()},buildPartialSkipUrl:function(e,t){var r=e.request.url;if("GET"===e.request.method&&"reload"!==e.request.cache){var n=[];n.push("swskipheader","true");for(var o=(new Date).getTime(),a=0;a<t.length;a++)t[a].invalidationTime>o&&n.push("sw"+t[a].cachekey+"=skip");r=e.request.url+(e.request.url.indexOf("?")>-1?"&":"?")+n.join("&")}return r},buildCacheableURL:function(e,t){var r=e.request.url;if("GET"===e.request.method&&"reload"!==e.request.cache){var n=[];n.push("swskipheader","true");for(var o=(new Date).getTime(),a=0;a<t.length;a++)t[a].invalidationTime>o&&t[a].clearOnUrls.length>0&&n.push("sw"+t[a].cachekey+"=skip");r=e.request.url+(e.request.url.indexOf("?")>-1?"&":"?")+n.join("&")}return r},recreateDBStores:function(e){var t=e.result||{result:e},r=t.result.objectStoreNames;Array.from(r).forEach(t.result.deleteObjectStore),t.result.createObjectStore("caches",{keyPath:"cachekey"}).createIndex("context, contextid",["context","contextid"]),t.result.createObjectStore("urlmapping",{keyPath:"url"}).createIndex("contextid","contextid",{unique:!1})},storeHttpHeaderInDB:function(e,t){var r=indexedDB.open("PartialPageCache");r.onupgradeneeded=this.recreateDBStores,r.onsuccess=function(){try{var n=r.result.transaction("urlmapping","readwrite").objectStore("urlmapping"),o="";if(t.headers.forEach((function(e,t){"x-sf-cc-cachecontext"===t&&(o=e)})),o){var a={url:e,contextid:o};n.put(a)}}catch(e){console&&console.error("Cannot write URL mapping to indexed DB",e)}r.result.close()}}};t.utils=r},10:function(e,t,r){"use strict";r.r(t);var n=r(0),o=r(7),a=self.serverConstructedUrls.offlineUrl,c=self.serverConstructedUrls.headerUrl;self.wrappedDb={openDb:o.openDb},self.pagepartials={createPageStream:function(e,t){const r=new ReadableStream({start(r){!async function(){new URL(e.url).searchParams.append("swskipheader","true");var o=await caches.open("clearers"),a=await o.match(e.url),i=await caches.open("v1");a&&(await i.delete(c),await n.utils.reloadHeader(c,i));var s=await caches.open("skippers"),u=!1;if(!await s.match(e.url)){var l=await i.match(c);l?u=!0:l=await n.utils.reloadHeader(c,i),await n.utils.pushOnStream(l.body,r)}var p=await self.pagepartials.generatePageResponse(t,u);await n.utils.pushOnStream(p.body,r),r.close()}()}});return new Response(r,{headers:{"Content-Type":"text/html; charset=utf-8"}})},generatePageResponse:function(e,t){var r=e.request.url;return"navigate"!==e.request.mode&&(r=self.currentFullPageUrl),new Promise((function(o){!async function(){var c=e.request,i=[],s=[],u=!1,l=!0;try{var p=await self.wrappedDb.openDb("PartialPageCache",1,n.utils.recreateDBStores);const t=p.transaction("urlmapping");var f,d=await t.objectStore("urlmapping").get(r).then(e=>e);f=d?JSON.parse(d.contextid):{context:"nocontext",contextid:"nocontextid"};const o=p.transaction("caches");o.objectStore("caches").index("context, contextid").openCursor(IDBKeyRange.only(["global",""])).then((function t(r){if(r){var n=!1;r.value.clearOnUrls.forEach((function(t){e.request.url.indexOf(t)>-1&&(n=!0)})),n?s.push(r.value):i.length<50&&i.push(r.value),r.continue().then(t)}})),await o.complete;const a=p.transaction("caches");a.objectStore("caches").index("context, contextid").openCursor(IDBKeyRange.only([f.context,f.contextid])).then((function e(t){t&&i.length<50&&(i.push(t.value),t.continue().then(e))})),await a.complete;var h=p.transaction("caches","readwrite").objectStore("caches");s.forEach((function(e){h.delete(e.cachekey)}))}catch(e){console&&console.error("Indexed DB unavailable",e)}try{var y=n.utils.buildPartialSkipUrl(e,i);"GET"===e.request.method&&(c=new Request(y))}catch(e){u=!0,console&&console.error("error on creating server request",e)}let v=await caches.open("v1");var b=n.utils.buildCacheableURL(e,i),m=new Request(b),x=await v.match(m);if(void 0===x||n.utils.isCacheExpired(x)||u||"reload"===c.cache)try{var w=await fetch(c);n.utils.storeHttpHeaderInDB(e.request.url,w),x=w}catch(e){if(l=!1,!x){var g=await caches.open("offline");x=await g.match(a)}}else l=!1;if("GET"!==c.method)o(x);else{let e=await x.text();var _=!1;x.headers.forEach((function(e,t){"x-sf-cc-cachetime"===t&&(_=!0)}));var S=n.utils.createResponseSkeleton(x),D=new Response(e.replace(/\$swcached\$/g,"true"),S);if(_&&l){(await caches.open("v1")).put(m,D)}var P=n.utils.replacePartialPlaceholder(e,i,t);x=new Response(P,S),o(x)}}()}))}},self.addEventListener("message",(function(e){var t=e.data;"setUrl"===t.command&&(self.currentFullPageUrl=t.message)}))},7:function(e,t,r){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function r(e){return new Promise((function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function n(e,t,n){var o,a=new Promise((function(a,c){r(o=e[t].apply(e,n)).then(a,c)}));return a.request=o,a}function o(e,t,r){var o=n(e,t,r);return o.then((function(e){if(e)return new l(e,o.request)}))}function a(e,t,r){r.forEach((function(r){Object.defineProperty(e.prototype,r,{get:function(){return this[t][r]},set:function(e){this[t][r]=e}})}))}function c(e,t,r,o){o.forEach((function(o){o in r.prototype&&(e.prototype[o]=function(){return n(this[t],o,arguments)})}))}function i(e,t,r,n){n.forEach((function(n){n in r.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})}))}function s(e,t,r,n){n.forEach((function(n){n in r.prototype&&(e.prototype[n]=function(){return o(this[t],n,arguments)})}))}function u(e){this._index=e}function l(e,t){this._cursor=e,this._request=t}function p(e){this._store=e}function f(e){this._tx=e,this.complete=new Promise((function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}}))}function d(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new f(r)}function h(e){this._db=e}function y(e,t,r){var o=n(indexedDB,"open",[e,t]),a=o.request;return a&&(a.onupgradeneeded=function(e){r&&r(new d(a.result,e.oldVersion,a.transaction))}),o.then((function(e){return new h(e)}))}a(u,"_index",["name","keyPath","multiEntry","unique"]),c(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),s(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),a(l,"_cursor",["direction","key","primaryKey","value"]),c(l,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(e){e in IDBCursor.prototype&&(l.prototype[e]=function(){var t=this,n=arguments;return Promise.resolve().then((function(){return t._cursor[e].apply(t._cursor,n),r(t._request).then((function(e){if(e)return new l(e,t._request)}))}))})})),p.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},p.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},a(p,"_store",["name","keyPath","indexNames","autoIncrement"]),c(p,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),s(p,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(p,"_store",IDBObjectStore,["deleteIndex"]),f.prototype.objectStore=function(){return new p(this._tx.objectStore.apply(this._tx,arguments))},a(f,"_tx",["objectStoreNames","mode"]),i(f,"_tx",IDBTransaction,["abort"]),d.prototype.createObjectStore=function(){return new p(this._db.createObjectStore.apply(this._db,arguments))},a(d,"_db",["name","version","objectStoreNames"]),i(d,"_db",IDBDatabase,["deleteObjectStore","close"]),h.prototype.transaction=function(){return new f(this._db.transaction.apply(this._db,arguments))},a(h,"_db",["name","version","objectStoreNames"]),i(h,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[p,u].forEach((function(r){e in r.prototype&&(r.prototype[e.replace("open","iterate")]=function(){var r=t(arguments),n=r[r.length-1],o=this._store||this._index,a=o[e].apply(o,r.slice(0,-1));a.onsuccess=function(){n(a.result)}})}))})),[u,p].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var r=this,n=[];return new Promise((function(o){r.iterateCursor(e,(function(e){e?(n.push(e.value),void 0===t||n.length!=t?e.continue():o(n)):o(n)}))}))})})),e.openDb=y,self.sfraIdb={openDb:y},e.deleteDb=function(e){return n(indexedDB,"deleteDatabase",[e])},Object.defineProperty(e,"__esModule",{value:!0})}(t)}});